\subsection{Overview of phylodynamics}

In evolutionary biology, a \defn{phylogeny}, or \defn{phylogenetic tree}, is a
graphical representation of the evolutionary relationships among a group of
organisms or species. Phylogenies consist of nodes, representing organisms or
species (generally, \defn{taxa}), and edges or branches, which link taxa to
their ancestors and descendants. The \defn{tips} of the phylogeny, that is, the
nodes without any descendants, correspond to \defn{extant}, or observed, taxa.
The \defn{internal nodes} correspond to their extinct common ancestors. The
phylogeny may have a \defn{root}, which is a node with no descendants
distinguished as the most recent common ancestor of all the extant taxa. When
such a root exists, the tree is referred to as being \defn{rooted}; otherwise,
it is \defn{unrooted}. The structural arrangement of nodes and edges in the
tree is referred to as its \defn{topology}. The branches of the phylogeny may
have lengths, which can represent either the genetic distance, or the calendar
time, between ancestors and their descendants. Phylogenies whose branch lengths
are in units of calendar time are referred to as \defn{time-scaled}.

In the case of a rooted tree with branch lengths in calendar time, the internal
nodes can be mapped onto a timeline by using the tips of the phylogeny, which
usually map to the present day, as a reference point. These \defn{branching
times} correspond to the times at which speciation events
occurred~\autocite{nee1992tempo}. In phylogenies relating animal species,
speciation most often occurs by an \defn{allopatric} process, where a
sub-population of organisms is geographically isolated from the original
population [a reference to Coyne \& Orr will go here once I skim the relevant
bits of the book]. Over time, the two populations diverge genetically,
eventually resulting in two distinct species.

Many RNA viruses, such as the human immuno-deficiency virus (HIV), evolve
rapidy enough that populations can accumulate measurable genetic changes on
time scales of months or years~\autocite{drummond2003measurably}. Transmission
of the virus from one host to another closely mirrors the allopatric speciation
process. Upon transmission, a sub-population of virions from the donor host is
geographically isolated in the recpient, followed by genetic divergence of the
two hosts' infections. Therefore, the branching time relating the two hosts'
viral populations in a time-scaled phylogeny corresponds to the time of
transmission. This correspondence can be quite rough, and is subject to some
important limitations which are discussed below. However, even taking these
limitations into account, the relationship between branching times in the
phylogeny and transmission times in the population theoretically implies that
the evolutionary history of the virus is informative about its epidemiology. In
other words, information about transmission patterns can be inferred from the
viral phylogeny, complementing more traditional survey-based epidemiological
methods. The tools and techniques for making such inferences are referred to as
\defn{phylodynamic} methods.

\subsection{Sources of error in phylodynamics}

In general, the exact topology and branch lengths of a phylogeny relating
arbitrary taxa are not known and must be estimated. Such estimation is most
often carried out using some type of genetic data sampled from each of the
taxa, either amino acid sequences or gene orders. The resulting phylogeny, also
known as a \defn{gene tree}, differs from the time-scaled \defn{species tree}
which would contain complete information about past speciation events. In
viral phylogenetics, the gene tree is the viral phylogeny, constructed using
the genetic sequences of the sampled viruses. On the other hand, the species
tree is the \defn{transmission tree}, wherein branching times correspond
exactly to transmission times. In general, phylodynamic methods perform
inference based on the transmission tree, which must be inferred from a viral
phylogeny based on the available sequence data. The inference of the viral
phylogeny itself is not an error-free process, as accurate phylogenetic
inference is still an active area of research. Moreover, the conversion of the
phylogeny into a transmission tree is a process which has the potential to
introduce at least three types of error, described below. We use the terms
``gene tree'', ``viral phylogeny'', and ``phylogeny'' interchangably, as well
as the terms ``species tree'' and ``transmission tree''.

Firstly, the branch lengths of the gene tree are measured in genetic distance,
and must be somehow converted to units of calendar time used in the species
tree. If we assume a constant rate of evolution along the whole tree (a
\defn{strict molecular clock}), then this conversion is straightforward - we
simply divide each of the branch lengths by the rate of evolution. However, it
is well known that rates of evolution are neither constant over time nor
constant between lineages, and the general problem of time-scaling a
phylogenetic tree is still an active area of research. Phylodynamic inference
relies on the assumption of a correctly time-scaled tree, and violations of
this assumption can mislead parameter estimates.

A second limitation which has perhaps greater potential to mislead phylodynamic
inference is the potential discordance between the gene tree and the species
tree. In an allopatric speciation, some of the genetic diversity separating the
two eventual species may already have been present in the population
\emph{before} the geographic isolation occured. In that case, the branching
time in the gene tree, which indicates the time when two genetically distinct
versions of the gene, may be earlier than the branching point in the species
tree. In evolutionary biology, this phenomenon is referred to as
\defn{incomplete lineage sorting}. Furthermore, if there was substantial
variation within a population which underwent two or more speciation events in
close succession, the order in which the species diverged may be different from
the order in which their distinct genes arose in the original heterogeneous
population. In this case, the topology of the species tree would be different
from that of the gene tree. 

Finally, there is the problem of rooting the tree, that is, identifying the
node corresponding to the most recent common ancestor of all the sampled
viruses. The choice of root influences the temporal order of the internal
nodes in the phylogeny. If the tips are constrained to the present day, or some
other fixed sampling time, the branch lengths in the species tree must also be
altered to accomodate the choice of root. 

To our knowledge, there has been no theoretical exploration of the quantitative
effect of any of these sources of error on the accuracy of phylodynamic
inference. Most phylodynamic studies assume, implicitly or explicitly, that the
viral phylogeny provides the same information as the transmission tree, and
errors introduced by this assumption are generally ignored. Studies employing
Bayesian methods eliminate some of the uncertainty associated with constructing
the viral phylogeny, but this does not account for the error introduced in the
phylogeny-to-transmission-tree conversion process. Our work does not take a
Bayesian approach to inferring the phylogeny, and therefore is susceptible to
all the sources of error discussed here.

\subsection{Contact networks}

Compartmental models of epidemic growth and spread often assume that human
populations are homogeneously mixed, that is, any person in the population is
equally likely to transmit the infection to any other. More sophisticated
models allow for the population to be divided into groups with higher or lower
contact rates, but these still do not account for individual variation or
population structure within compartments. In reality, and especially for
sexually-transmitted infections such as HIV, this assumption of homogeneity is
not realistic. There is substantial variation in the number of contacts per
individual, and potential transmissions are limited by geographic proximity.
The aim of using contact networks is to remove these unrealistic assumptions by 
explicitly simulating each individual in a population, along with the contacts
they have which could possibly lead to a transmission.

A \defn{contact network} is a graphical representation of a population over
which an epidemic can spread. Contact networks consist of nodes and edges,
where the nodes represent people, and edges represent contacts. An edge between
two nodes indicate that transmission is possible between the two corresponding
individuals. For example, if we are considering an HIV transmission network,
the edges may represent sexual contacts or individuals sharing injection drug
paraphernalia. For an airborne pathogen such as influenza, an edge may simply
indicate that the two people were in the same room. The edges in a contact
network may be undirected, indicating that all contacts could possibly transmit
to each other, or directed, indicating that transmission risk is one-way. It is
possible to simulate an undirected network using directed edges by simply
including two directed edges, one in either direction, for each single directed
edge. Therefore, we exclusively consider directed contact networks here.

Contact networks have been studied extensively in a variety of social,
economic, and public health contexts. However, investigation of the effects of
contact network structures on viral phylogenies have been much more limited.
Existing studies have to focused on a few broad classes of contact network, and
how phylogenies deriving from these networks have
differed~\autocite{leventhal2012inferring, colijn2014phylogenetic,
robinson2013dynamics}. To demonstrate our method, we focus on the same three
contact network types as studied in~\autocite{leventhal2012inferring}, namely
Erdos-Renyi (ER) graphs, Barabasi-Albert (BA) graphs, and Watts-Strogatz (WS)
graphs. ER graphs, also known as random graphs, are the simplest generative
graph model~\autocite{erdos1960evolution}. They have a single parameter, $p$,
which gives the probability of any edge occuring in the network. BA
graphs~\autocite{barabasi1999emergence} model a preferential attachment process
where nodes with high degree tend to attract more connections. They have two
parameters, $m$ and $\alpha$, and are constructed by repeatedly adding new
nodes with $m$ outgoing edges to the network. An existing node $v$ in the
network is chosen to be the endpoint of these new edges with probability
proportional to $d(v)^\alpha$, where $d(v)$ is the degree of $v$. WS
graphs~\autocite{watts1998collective}, also known as small-world graphs, have
two parameters, $k$ and $p$. They are constructed by creating a ring lattice
with $k$ edges per node, and then randomly rewiring each edge with probability
$p$.

\subsection{Approximate Bayesian computation}

Consider a model $M$, with parameters $\theta$, which we wish to fit to some
observed data $D$. By ``fit'', we often mean that we want to find particular
values $\hat{\theta}$ for the parameters which optimize the likelihood of our
data given those parameters and the model,
\[
  \hat{\theta} = \argmax_\theta \Pr(D | M, \theta).
\]
This $\hat{\theta}$ is the \defn{maximum likelihood} parameter estimate. Note
that we are employing a common abuse of notation here, where $\Pr(\cdots)$ is
being unsed to refer to a probabilty \emph{density} rather than a true
probability. Alternative to maximum likelihood, we may be interested less in a
point estimate and more in the posterior distribution of possible values of
$\theta$ given our data, $\Pr(\theta \mid M, D)$. This will be expanded upon
below, but for the moment, for illustrative purposes, we restrict our attention
to the maximum likelihood problem.

If the model we are fitting is sufficiently simple, it may be possible to
calculate $\hat{\theta}$ directly, using calculus. Most models do not admit
analytic maximum likeilhood solutions, but if the likelihood any set of
parameters can be calculated up to a normalizing constant, then
${\Pr(D \mid M,\theta)}$ can be optimized numerically. A wide range of
optimization strategies exist, the choice of which to use depending on the
complexity of the model and whether or not we have access to the gradients of
the likelihood function with respect to each of the parameters. The majority of
modelling problems fit into this category, and numerical optimization is
well-developed and extremely widely used.

However, there are some cases, often when the observed data is of a complex
type, that explicitly calculating the likelihood of some observed data is
impossible, even up to a normalizing constant. For example, suppose that we
want to model a chess player's behaviour. We will set up a simple one-parameter
model which describes the chess playing process.  The parameter, $a \in [0, 1]$
indicates the player's eagerness to remove his opponent's pieces from the
board. We can write down an algorithm for the player's behaviour under such a
model.

% TODO: don't break this over the page

\begin{algorithmic}
  \While{the game is not over}
    \If{I can capture an opponent's piece and $\Uniform(0, 1) < a$}
      \State{capture the piece}
    \Else
      \State{make any other move at random}
    \EndIf
  \EndWhile
\end{algorithmic}

Suppose the observed data are the ending configurations of the board, after the
player has concluded a game against an opponent with a known value of $a$. The
model we have designed is very simple, but it is not obvious how to calculate
the likelihood of a particular ending configuration. Indeed, it seems that the
only way is to enumerate every possible path the game could have taken, and
tabulate the ending configurations of each. Clearly, this is infeasible.
Approximate Bayesian computation was designed for situations like these, where
exact likelihoods are not available, perhaps due to the model involving an
algorithm or generative process, but we still want to estimate the parameters.
