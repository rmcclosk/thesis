Name: abc-mean-degree
Processes: 1
Steps:
    network:
        Extension: gml
        Parameters:
            nnode: 5000
            mean_degree: [2, 4, 8, 16]
            pa_power: 1
            replicate: !!python/object/apply:__builtin__.xrange [0, 100, 1]
        Interpreter: R --vanilla --silent
        Startup: |
            suppressPackageStartupMessages(library(netabc))
        Rule: | 
            # unique seed for each network
            set.seed({replicate} + ({mean_degree} * 100))
            g <- sample_pa({nnode}, m={mean_degree}/2, power={pa_power}, directed=FALSE)
            graph_attr(g, "comment") <- "{yaml}"
            write.graph(SI.net(g), "{network}", format="gml")

    tree:
        Extension: nwk
        Parameters:
            nnode: 5000
            mean_degree: [2, 4, 8, 16]
            pa_power: 1
            replicate: !!python/object/apply:__builtin__.xrange [0, 100, 1]
            nsimnode: 1000
            ntip: [100, 500, 1000]
        Depends: network
        Interpreter: bash
        Rule: |
            # unique seed for each tree, different from the network ones
            SEED=`echo "{replicate} + ({mean_degree} * 100) + 2000" | bc`
            echo "#{yaml}" > {tree}
            nettree --sim-nodes {nsimnode} --tree-tips {ntip} --seed $SEED {network} >> {tree}

    abc-config:
        Extension: yaml
        Parameters:
            nnode: 5000
            nsimnode: 1000
            edges_per_node_min: 1
            edges_per_node_max: 10
            pa_power: 1
        Interpreter: bash
        Rule: |
            echo "nodes: {nnode}" > {abc-config}
            echo "sim_nodes: {nsimnode}" >> {abc-config}
            echo "edges_per_node: [\"uniform\", {edges_per_node_min}, {edges_per_node_max}]"
            echo "attach_power: {pa_power}" >> {abc-config}

    abc:
        Extension: tsv
        Processes: 1
        Parameters:
            nnode: 5000
            mean_degree: [2, 4, 8, 16]
            seed: 0
            nsimnode: 1000
            ntip: 1000
            nthread: 20
            decay_factor: 0.3
            rbf_variance: 10
            nparticle: 2000
            nsample: 10
            quality: 0.95
            edges_per_node_min: 1
            edges_per_node_max: 10
            pa_power: 1
        Depends: tree abc-config
        Interpreter: bash
        Rule: |
            echo "#{yaml}" > {abc}
            netabc --num-threads {nthread} --decay-factor {decay_factor} \
                   --rbf-variance {rbf_variance} --num-particles {nparticle} \
                   --num-samples {nsample} --quality {quality} --net-type pa \
                   --trace {abc} {tree} {abc-config} 
