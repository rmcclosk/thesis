Name: abc-smallworld
Description: ABC inference on 2-parameter small world networks
Processes: 1
Steps:
    network:
        Extension: gml
        Parameters:
            nnode: 5000
            rewire_prob: [0.01, 0.05, 0.09]
            nbhd_size: [2, 4, 6]
            replicate: 0
        Interpreter: R --vanilla --silent
        Startup: |
            suppressPackageStartupMessages(library(netabc))
            suppressPackageStartupMessages(library(VGAM))
        Rule: | 
            set.seed({seed})
            g <- sample_smallworld(1, {nnode}, {nbhd_size}, {rewire_prob})
            graph_attr(g, "comment") <- "{yaml}"
            write.graph(SI.net(g), "{network}", format="gml")

    tree:
        Extension: nwk
        Parameters:
            rewire_prob: [0.01, 0.05, 0.09]
            nbhd_size: [2, 4, 6]
            ntip: 1000
            nsimnode: 1000
            replicate: 0
        Depends: network
        Interpreter: bash
        Rule: |
            echo "#{yaml}" > {tree}
            nettree --sim-nodes {nsimnode} --tree-tips {ntip} --seed {seed} {network} >> {tree}

    abc-config:
        Extension: yaml
        Parameters:
            nnode: 5000
            nsimnode: 1000
            rewire_min: 0
            rewire_max: 0.1
            nbhd_min: 1
            nbhd_max: 10
        Interpreter: bash
        Rule: |
            echo "nodes: {nnode}" > {abc-config}
            echo "sim_nodes: {nsimnode}" >> {abc-config}
            echo "sim_time: 0" >> {abc-config}
            echo "transmit: 1" >> {abc-config}
            echo "remove: 0" >> {abc-config}
            echo "nbhd_size: [\"uniform\", {nbhd_min}, {nbhd_max}]" >> {abc-config}
            echo "rewire_prob: [\"uniform\", {rewire_min}, {rewire_max}]" >> {abc-config}

    abc:
        Extension: tsv
        Processes: 1
        Parameters:
            rewire_prob: [0.01, 0.05, 0.09]
            nbhd_size: [2, 4, 6]
            replicate: 0
            nthread: 20
            decay_factor: 0.3
            rbf_variance: 5
            nparticle: 1000
            nsample: 5
            quality: 0.95
            final_epsilon: 0.0
            final_accept: 0.015
        Depends: tree abc-config
        Interpreter: bash
        Rule: |
            echo "#{yaml}" > {abc}
            netabc --num-threads {nthread} --decay-factor {decay_factor} \
                   --rbf-variance {rbf_variance} --num-particles {nparticle} \
                   --num-samples {nsample} --quality {quality} --seed {seed} \
                   --final-epsilon {final_epsilon} --final-accept {final_accept} \
                   --net-type sw --trace {abc} {tree} {abc-config} 
